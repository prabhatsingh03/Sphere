<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Approval System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .success-bg {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .reject-bg {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        .card-shadow {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation Header -->
    <nav class="gradient-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-building text-2xl"></i>
                    <h1 class="text-xl font-bold">SPHERE</h1>
                    <p class="text-xs text-slate-100 font-medium hidden sm:block">Smart Platform for Harmonized E-Procurement & Resource Exchange</p>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/po_system" class="hover:text-gray-200 transition-colors">
                        <i class="fas fa-home mr-2"></i>Dashboard
                    </a>
                    <a href="/logout" class="hover:text-gray-200 transition-colors">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto px-4 py-8">
        <!-- PR Approval Section -->
        <div id="pr-approval-section" class="hidden">
            <!-- PR Approval Success -->
            <div id="pr-approval-success" class="hidden">
                <div class="success-bg text-white rounded-lg p-8 text-center card-shadow">
                    <div class="mb-6">
                        <i class="fas fa-check-circle text-6xl mb-4"></i>
                        <h2 class="text-3xl font-bold mb-2">Purchase Request Approved!</h2>
                        <p class="text-lg opacity-90">The PR has been successfully approved and is now ready for the next stage.</p>
                    </div>
                    
                    <div class="bg-white bg-opacity-20 rounded-lg p-6 mb-6">
                        <h3 class="text-xl font-semibold mb-4">PR Details</h3>
                        <div class="grid grid-cols-2 gap-4 text-left">
                            <div>
                                <span class="font-semibold">PR Number:</span>
                                <span id="pr-number-display" class="ml-2"></span>
                            </div>
                            <div>
                                <span class="font-semibold">Project:</span>
                                <span id="pr-project-display" class="ml-2"></span>
                            </div>
                            <div>
                                <span class="font-semibold">Department:</span>
                                <span id="pr-dept-display" class="ml-2"></span>
                            </div>
                            <div>
                                <span class="font-semibold">Requester:</span>
                                <span id="pr-requester-display" class="ml-2"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <a href="/po_system" class="inline-block bg-white text-green-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </a>
                        <p class="text-sm opacity-75">An email notification has been sent to the requester.</p>
                    </div>
                </div>
            </div>

            <!-- PR Rejection Form -->
            <div id="pr-rejection-form" class="hidden">
                <div class="bg-white rounded-lg shadow-lg p-8 card-shadow">
                    <div class="text-center mb-8">
                        <div class="reject-bg text-white rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-times text-3xl"></i>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Reject Purchase Request</h2>
                        <p class="text-gray-600">Please provide feedback for the rejection. This will be sent to the requester.</p>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-6 mb-8">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">PR Details</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <span class="font-semibold text-gray-700">PR Number:</span>
                                <span id="pr-reject-number" class="ml-2"></span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Project:</span>
                                <span id="pr-reject-project" class="ml-2"></span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Department:</span>
                                <span id="pr-reject-dept" class="ml-2"></span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Requester:</span>
                                <span id="pr-reject-requester" class="ml-2"></span>
                            </div>
                        </div>
                    </div>

                    <form id="pr-rejection-form-submit" class="space-y-6">
                        <div>
                            <label for="rejection-reason" class="block text-sm font-medium text-gray-700 mb-2">
                                Rejection Reason <span class="text-red-500">*</span>
                            </label>
                            <select id="rejection-reason" name="rejection_reason" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent">
                                <option value="">Select a reason</option>
                                <option value="Incomplete Information">Incomplete Information</option>
                                <option value="Budget Exceeded">Budget Exceeded</option>
                                <option value="Technical Specifications Unclear">Technical Specifications Unclear</option>
                                <option value="Vendor Selection Issues">Vendor Selection Issues</option>
                                <option value="Timeline Constraints">Timeline Constraints</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div>
                            <label for="rejection-details" class="block text-sm font-medium text-gray-700 mb-2">
                                Additional Details <span class="text-red-500">*</span>
                            </label>
                            <textarea id="rejection-details" name="rejection_details" rows="4" required 
                                placeholder="Please provide specific details about why this PR is being rejected and what needs to be addressed..."
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"></textarea>
                        </div>

                        <div>
                            <label for="suggested-actions" class="block text-sm font-medium text-gray-700 mb-2">
                                Suggested Actions
                            </label>
                            <textarea id="suggested-actions" name="suggested_actions" rows="3" 
                                placeholder="What actions should the requester take to address the issues?"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"></textarea>
                        </div>

                        <div class="flex space-x-4 pt-4">
                            <button type="submit" class="flex-1 bg-red-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                                <i class="fas fa-times mr-2"></i>Confirm Rejection
                            </button>
                            <a href="/po_system" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors text-center">
                                <i class="fas fa-arrow-left mr-2"></i>Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- PO Approval Section -->
        <div id="po-approval-section" class="hidden">
            <!-- PO Approval Success -->
            <div id="po-approval-success" class="hidden">
                <div class="success-bg text-white rounded-lg p-8 text-center card-shadow">
                    <div class="mb-6">
                        <i class="fas fa-check-circle text-6xl mb-4"></i>
                        <h2 class="text-3xl font-bold mb-2">Purchase Order Approved!</h2>
                        <p class="text-lg opacity-90" id="po-approval-message">
                            The PO has been successfully approved and is now ready for processing.
                        </p>
                    </div>
                    
                    <div class="bg-white bg-opacity-20 rounded-lg p-6 mb-6">
                        <h3 class="text-xl font-semibold mb-4">PO Details</h3>
                        <div class="grid grid-cols-2 gap-4 text-left">
                            <div>
                                <span class="font-semibold">PO Number:</span>
                                <span id="po-number-display" class="ml-2"></span>
                            </div>
                            <div>
                                <span class="font-semibold">Project:</span>
                                <span id="po-project-display" class="ml-2"></span>
                            </div>
                            <div>
                                <span class="font-semibold">Vendor:</span>
                                <span id="po-vendor-display" class="ml-2"></span>
                            </div>
                            <div>
                                <span class="font-semibold">Total Amount:</span>
                                <span id="po-amount-display" class="ml-2"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <a href="/po_system" class="inline-block bg-white text-green-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
                            <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                        </a>
                        <p class="text-sm opacity-75">An email notification has been sent to the requester.</p>
                    </div>
                </div>
            </div>







            <!-- PO Rejection Form -->
            <div id="po-rejection-form" class="hidden">
                <div class="bg-white rounded-lg shadow-lg p-8 card-shadow">
                    <div class="text-center mb-8">
                        <div class="reject-bg text-white rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-times text-3xl"></i>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Reject Purchase Order</h2>
                        <p class="text-gray-600">Please provide feedback for the rejection. This will be sent to the requester.</p>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-6 mb-8">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">PO Details</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <span class="font-semibold text-gray-700">PO Number:</span>
                                <span id="po-reject-number" class="ml-2"></span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Project:</span>
                                <span id="po-reject-project" class="ml-2"></span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Vendor:</span>
                                <span id="po-reject-vendor" class="ml-2"></span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Total Amount:</span>
                                <span id="po-reject-amount" class="ml-2"></span>
                            </div>
                        </div>
                    </div>

                    <form id="po-rejection-form-submit" class="space-y-6">
                        <div>
                            <label for="po-rejection-reason" class="block text-sm font-medium text-gray-700 mb-2">
                                Rejection Reason <span class="text-red-500">*</span>
                            </label>
                            <select id="po-rejection-reason" name="rejection_reason" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent">
                                <option value="">Select a reason</option>
                                <option value="Pricing Issues">Pricing Issues</option>
                                <option value="Vendor Concerns">Vendor Concerns</option>
                                <option value="Contract Terms">Contract Terms</option>
                                <option value="Budget Constraints">Budget Constraints</option>
                                <option value="Technical Specifications">Technical Specifications</option>
                                <option value="Timeline Issues">Timeline Issues</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div>
                            <label for="po-rejection-details" class="block text-sm font-medium text-gray-700 mb-2">
                                Additional Details <span class="text-red-500">*</span>
                            </label>
                            <textarea id="po-rejection-details" name="rejection_details" rows="4" required 
                                placeholder="Please provide specific details about why this PO is being rejected and what needs to be addressed..."
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"></textarea>
                        </div>

                        <div>
                            <label for="po-suggested-actions" class="block text-sm font-medium text-gray-700 mb-2">
                                Suggested Actions
                            </label>
                            <textarea id="po-suggested-actions" name="suggested_actions" rows="3" 
                                placeholder="What actions should the requester take to address the issues?"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"></textarea>
                        </div>

                        <div class="flex space-x-4 pt-4">
                            <button type="submit" class="flex-1 bg-red-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                                <i class="fas fa-times mr-2"></i>Confirm Rejection
                            </button>
                            <a href="/po_system" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors text-center">
                                <i class="fas fa-arrow-left mr-2"></i>Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div id="error-state" class="hidden text-center py-12">
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mx-auto max-w-md">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle text-xl mr-2"></i>
                    <span id="error-message" class="font-semibold">An error occurred</span>
                </div>
                <div class="mt-4">
                    <a href="/po_system" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                    </a>
                </div>
            </div>
        </div>

        <!-- Message State -->
        <div id="message-state" class="hidden text-center py-12">
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mx-auto max-w-md">
                <div class="flex items-center">
                    <i class="fas fa-check-circle text-xl mr-2"></i>
                    <span id="success-message" class="font-semibold">Success!</span>
                </div>
                <div class="mt-4">
                    <a href="/po_system" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                    </a>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="text-center py-12">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">Processing your request...</p>
        </div>
    </div>

    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const type = urlParams.get('type'); // 'pr' or 'po'
        const action = urlParams.get('action'); // 'approve' or 'reject'
        const id = urlParams.get('id'); // PR or PO number
        const role = urlParams.get('role'); // Approver role
        
        // Check if there's an error parameter from the backend
        const error = urlParams.get('error');
        
        // Check if there's a message parameter from the backend (success message)
        const message = urlParams.get('message');

        // Show appropriate section based on type and action
        function showSection() {
            document.getElementById('loading-state').style.display = 'none';
            
            // Check if there's a message first (success message)
            if (message) {
                document.getElementById('message-state').classList.remove('hidden');
                document.getElementById('success-message').textContent = message;
                return;
            }
            
            // Check if there's an error
            if (error) {
                document.getElementById('error-state').classList.remove('hidden');
                document.getElementById('error-message').textContent = error;
                return;
            }
            
            if (type === 'pr') {
                document.getElementById('pr-approval-section').classList.remove('hidden');
                if (action === 'approve') {
                    // Show confirmation for PR approval with reject option
                    const container = document.getElementById('pr-approval-section');
                    container.classList.remove('hidden');
                    container.innerHTML = `
                        <div class="bg-white rounded-lg shadow-lg p-8 card-shadow">
                          <h2 class="text-2xl font-bold mb-4">Review Purchase Requisition</h2>
                          <p class="text-gray-700 mb-6">Please review PR <strong>${id}</strong> and choose your action.</p>
                          
                          <div class="bg-gray-50 rounded-lg p-6 mb-8">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">PR Details</h3>
                            <div class="grid grid-cols-2 gap-4">
                              <div>
                                <span class="font-semibold text-gray-700">PR Number:</span>
                                <span id="pr-number-display" class="ml-2">${id}</span>
                              </div>
                              <div>
                                <span class="font-semibold text-gray-700">Project:</span>
                                <span id="pr-project-display" class="ml-2">Loading...</span>
                              </div>
                              <div>
                                <span class="font-semibold text-gray-700">Department:</span>
                                <span id="pr-dept-display" class="ml-2">Loading...</span>
                              </div>
                              <div>
                                <span class="font-semibold text-gray-700">Requester:</span>
                                <span id="pr-requester-display" class="ml-2">Loading...</span>
                              </div>
                            </div>
                          </div>
                          
                          <div class="flex space-x-4">
                            <button onclick="submitPRApproval()" class="bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                              <i class="fas fa-check mr-2"></i>Approve PR
                            </button>
                            <button onclick="showPRRejectionForm()" class="bg-red-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                              <i class="fas fa-times mr-2"></i>Reject PR
                            </button>
                            <a href="/po_system" class="bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                              <i class="fas fa-arrow-left mr-2"></i>Cancel
                            </a>
                          </div>
                        </div>`;
                    
                    // Load PR details after DOM is updated
                    setTimeout(loadPRDetails, 10);
                } else if (action === 'reject') {
                    document.getElementById('pr-rejection-form').classList.remove('hidden');
                    loadPRDetailsForRejection();
                }
            } else if (type === 'po') {
                document.getElementById('po-approval-section').classList.remove('hidden');
                
                if (action === 'approve') {
                    // Show confirmation for PO approval with reject option
                    const container = document.getElementById('po-approval-section');
                    container.classList.remove('hidden');
                    container.innerHTML = `
                        <div class="bg-white rounded-lg shadow-lg p-8 card-shadow">
                          <h2 class="text-2xl font-bold mb-4">Review Purchase Order</h2>
                          <p class="text-gray-700 mb-6">Please review PO <strong>${id}</strong> as <strong>${role}</strong> and choose your action.</p>
                          
                          <div class="bg-gray-50 rounded-lg p-6 mb-8">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">PO Details</h3>
                            <div class="grid grid-cols-2 gap-4">
                              <div>
                                <span class="font-semibold text-gray-700">PO Number:</span>
                                <span id="po-number-display" class="ml-2">${id}</span>
                              </div>
                              <div>
                                <span class="font-semibold text-gray-700">Project:</span>
                                <span id="po-project-display" class="ml-2">Loading...</span>
                              </div>
                              <div>
                                <span class="font-semibold text-gray-700">Vendor:</span>
                                <span id="po-vendor-display" class="ml-2">Loading...</span>
                              </div>
                              <div>
                                <span class="font-semibold text-gray-700">Total Amount:</span>
                                <span id="po-amount-display" class="ml-2">Loading...</span>
                              </div>
                            </div>
                          </div>
                          
                          <div class="flex space-x-4">
                            <button onclick="submitPOApproval()" class="bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                              <i class="fas fa-check mr-2"></i>Approve PO
                            </button>
                            <button onclick="showPORejectionForm()" class="bg-red-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                              <i class="fas fa-times mr-2"></i>Reject PO
                            </button>
                            <a href="/po_system" class="bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                              <i class="fas fa-arrow-left mr-2"></i>Cancel
                            </a>
                          </div>
                        </div>`;
                    
                    // Load PO details after DOM is updated
                    setTimeout(loadPODetails, 10);
                } else if (action === 'reject') {
                    // Show rejection form for feedback when rejecting
                    document.getElementById('po-rejection-form').classList.remove('hidden');
                    loadPODetailsForRejection();
                }
            }
        }

        // Load PR details for approval success
        function loadPRDetails() {
            // These would be populated by the backend
            const prNumberEl = document.getElementById('pr-number-display');
            const prProjectEl = document.getElementById('pr-project-display');
            const prDeptEl = document.getElementById('pr-dept-display');
            const prRequesterEl = document.getElementById('pr-requester-display');
            
            if (prNumberEl) prNumberEl.textContent = id || 'N/A';
            if (prProjectEl) prProjectEl.textContent = 'Loading...';
            if (prDeptEl) prDeptEl.textContent = 'Loading...';
            if (prRequesterEl) prRequesterEl.textContent = 'Loading...';
            
            // Fetch actual PR details from backend
            if (id) {
                fetch(`/api/get_pr_details/${id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            console.error('Error loading PR details:', data.error);
                            return;
                        }
                        
                        // Update display with actual data
                        const prProjectEl = document.getElementById('pr-project-display');
                        const prDeptEl = document.getElementById('pr-dept-display');
                        const prRequesterEl = document.getElementById('pr-requester-display');
                        
                        if (prProjectEl) prProjectEl.textContent = data.project_name || 'N/A';
                        if (prDeptEl) prDeptEl.textContent = data.department || 'N/A';
                        if (prRequesterEl) prRequesterEl.textContent = data.requester || 'N/A';
                    })
                    .catch(error => {
                        console.error('Error fetching PR details:', error);
                        const prProjectEl = document.getElementById('pr-project-display');
                        const prDeptEl = document.getElementById('pr-dept-display');
                        const prRequesterEl = document.getElementById('pr-requester-display');
                        
                        if (prProjectEl) prProjectEl.textContent = 'Error loading';
                        if (prDeptEl) prDeptEl.textContent = 'Error loading';
                        if (prRequesterEl) prRequesterEl.textContent = 'Error loading';
                    });
            }
        }

        // Load PR details for rejection form
        function loadPRDetailsForRejection() {
            const prRejectNumberEl = document.getElementById('pr-reject-number');
            const prRejectProjectEl = document.getElementById('pr-reject-project');
            const prRejectDeptEl = document.getElementById('pr-reject-dept');
            const prRejectRequesterEl = document.getElementById('pr-reject-requester');
            
            if (prRejectNumberEl) prRejectNumberEl.textContent = id || 'N/A';
            if (prRejectProjectEl) prRejectProjectEl.textContent = 'Loading...';
            if (prRejectDeptEl) prRejectDeptEl.textContent = 'Loading...';
            if (prRejectRequesterEl) prRejectRequesterEl.textContent = 'Loading...';
            
            // Fetch actual PR details from backend
            if (id) {
                fetch(`/api/get_pr_details/${id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            console.error('Error loading PR details:', data.error);
                            return;
                        }
                        
                        // Update display with actual data
                        const prRejectProjectEl = document.getElementById('pr-reject-project');
                        const prRejectDeptEl = document.getElementById('pr-reject-dept');
                        const prRejectRequesterEl = document.getElementById('pr-reject-requester');
                        
                        if (prRejectProjectEl) prRejectProjectEl.textContent = data.project_name || 'N/A';
                        if (prRejectDeptEl) prRejectDeptEl.textContent = data.department || 'N/A';
                        if (prRejectRequesterEl) prRejectRequesterEl.textContent = data.requester || 'N/A';
                    })
                    .catch(error => {
                        console.error('Error fetching PR details:', error);
                        const prRejectProjectEl = document.getElementById('pr-reject-project');
                        const prRejectDeptEl = document.getElementById('pr-reject-dept');
                        const prRejectRequesterEl = document.getElementById('pr-reject-requester');
                        
                        if (prRejectProjectEl) prRejectProjectEl.textContent = 'Error loading';
                        if (prRejectDeptEl) prRejectDeptEl.textContent = 'Error loading';
                        if (prRejectRequesterEl) prRejectRequesterEl.textContent = 'Error loading';
                    });
            }
        }



        // Load PO details for approval success
        function loadPODetails() {
            const poNumberEl = document.getElementById('po-number-display');
            const poProjectEl = document.getElementById('po-project-display');
            const poVendorEl = document.getElementById('po-vendor-display');
            const poAmountEl = document.getElementById('po-amount-display');
            
            if (poNumberEl) poNumberEl.textContent = id || 'N/A';
            if (poProjectEl) poProjectEl.textContent = 'Loading...';
            if (poVendorEl) poVendorEl.textContent = 'Loading...';
            if (poAmountEl) poAmountEl.textContent = 'Loading...';
            
            // Update the approval message based on the role
            const messageElement = document.getElementById('po-approval-message');
            if (messageElement) {
                if (role && role.toLowerCase().includes('cfo')) {
                    messageElement.textContent = 'The PO has been fully approved and is now ready for execution.';
                } else if (role && role.toLowerCase().includes('ceo')) {
                    messageElement.textContent = 'The PO has been fully approved and is now ready for execution.';
                } else if (role && role.toLowerCase().includes('chairman')) {
                    messageElement.textContent = 'The PO has been fully approved and is now ready for execution.';
                } else {
                    messageElement.textContent = 'The PO has been approved and sent to the next approver for final review.';
                }
            }
            
            // Fetch actual PO details from backend
            if (id) {
                fetch(`/api/get_po_details/${id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            console.error('Error loading PO details:', data.error);
                            return;
                        }
                        
                        // Update display with actual data
                        const poProjectEl = document.getElementById('po-project-display');
                        const poVendorEl = document.getElementById('po-vendor-display');
                        const poAmountEl = document.getElementById('po-amount-display');
                        
                        if (poProjectEl) poProjectEl.textContent = data.project_name || 'N/A';
                        if (poVendorEl) poVendorEl.textContent = data.company || 'N/A';
                        if (poAmountEl) poAmountEl.textContent = data.total_amount || 'N/A';
                    })
                    .catch(error => {
                        console.error('Error fetching PO details:', error);
                        const poProjectEl = document.getElementById('po-project-display');
                        const poVendorEl = document.getElementById('po-vendor-display');
                        const poAmountEl = document.getElementById('po-amount-display');
                        
                        if (poProjectEl) poProjectEl.textContent = 'Error loading';
                        if (poVendorEl) poVendorEl.textContent = 'Error loading';
                        if (poAmountEl) poAmountEl.textContent = 'Error loading';
                    });
            }
        }

        // Load PO details for rejection form
        function loadPODetailsForRejection() {
            const poRejectNumberEl = document.getElementById('po-reject-number');
            const poRejectProjectEl = document.getElementById('po-reject-project');
            const poRejectVendorEl = document.getElementById('po-reject-vendor');
            const poRejectAmountEl = document.getElementById('po-reject-amount');
            
            if (poRejectNumberEl) poRejectNumberEl.textContent = id || 'N/A';
            if (poRejectProjectEl) poRejectProjectEl.textContent = 'Loading...';
            if (poRejectVendorEl) poRejectVendorEl.textContent = 'Loading...';
            if (poRejectAmountEl) poRejectAmountEl.textContent = 'Loading...';
            
            // Fetch actual PO details from backend
            if (id) {
                fetch(`/api/get_po_details/${id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            console.error('Error loading PO details:', data.error);
                            return;
                        }
                        
                        // Update display with actual data
                        const poRejectProjectEl = document.getElementById('po-reject-project');
                        const poRejectVendorEl = document.getElementById('po-reject-vendor');
                        const poRejectAmountEl = document.getElementById('po-reject-amount');
                        
                        if (poRejectProjectEl) poRejectProjectEl.textContent = data.project_name || 'N/A';
                        if (poRejectVendorEl) poRejectVendorEl.textContent = data.company || 'N/A';
                        if (poRejectAmountEl) poRejectAmountEl.textContent = data.total_amount || 'N/A';
                    })
                    .catch(error => {
                        console.error('Error fetching PO details:', error);
                        const poRejectProjectEl = document.getElementById('po-reject-project');
                        const poRejectVendorEl = document.getElementById('po-reject-vendor');
                        const poRejectAmountEl = document.getElementById('po-reject-amount');
                        
                        if (poRejectProjectEl) poRejectProjectEl.textContent = 'Error loading';
                        if (poRejectVendorEl) poRejectVendorEl.textContent = 'Error loading';
                        if (poRejectAmountEl) poRejectAmountEl.textContent = 'Error loading';
                    });
            }
        }

        // Submit PR approval
        function submitPRApproval() {
            // Show loading state
            const container = document.getElementById('pr-approval-section');
            container.innerHTML = `
                <div class="text-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                    <p class="text-gray-600">Processing approval...</p>
                </div>`;
            
            const formData = new FormData();
            formData.append('pr_number', id);
            formData.append('action', 'approve');
            formData.append('role', role);

            fetch('/approve_pr', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    document.getElementById('pr-approval-section').innerHTML = `
                        <div class="success-bg text-white rounded-lg p-8 text-center card-shadow">
                            <div class="mb-6">
                                <i class="fas fa-check-circle text-6xl mb-4"></i>
                                <h2 class="text-3xl font-bold mb-2">Purchase Request Approved!</h2>
                                <p class="text-lg opacity-90">The PR has been successfully approved and is now ready for the next stage.</p>
                            </div>
                            
                            <div class="bg-white bg-opacity-20 rounded-lg p-6 mb-6">
                                <h3 class="text-xl font-semibold mb-4">PR Details</h3>
                                <div class="grid grid-cols-2 gap-4 text-left">
                                    <div>
                                        <span class="font-semibold">PR Number:</span>
                                        <span id="pr-number-display" class="ml-2">${id}</span>
                                    </div>
                                    <div>
                                        <span class="font-semibold">Project:</span>
                                        <span id="pr-project-display" class="ml-2">Loading...</span>
                                    </div>
                                    <div>
                                        <span class="font-semibold">Department:</span>
                                        <span id="pr-dept-display" class="ml-2">Loading...</span>
                                    </div>
                                    <div>
                                        <span class="font-semibold">Requester:</span>
                                        <span id="pr-requester-display" class="ml-2">Loading...</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <a href="/po_system" class="inline-block bg-white text-green-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
                                    <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                                </a>
                                <p class="text-sm opacity-75">An email notification has been sent to the requester.</p>
                            </div>
                        </div>`;
                    
                    // Load PR details
                    loadPRDetails();
                } else {
                    alert('Error approving PR: ' + (data.message || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error approving PR. Please try again.');
            });
        }

        // Show PR rejection form
        function showPRRejectionForm() {
            const container = document.getElementById('pr-approval-section');
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-lg p-8 card-shadow">
                    <div class="text-center mb-8">
                        <div class="reject-bg text-white rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-times text-3xl"></i>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Reject Purchase Request</h2>
                        <p class="text-gray-600">Please provide feedback for the rejection. This will be sent to the requester.</p>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-6 mb-8">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">PR Details</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <span class="font-semibold text-gray-700">PR Number:</span>
                                <span class="ml-2">${id}</span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Project:</span>
                                <span id="pr-reject-project" class="ml-2">Loading...</span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Department:</span>
                                <span id="pr-reject-dept" class="ml-2">Loading...</span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Requester:</span>
                                <span id="pr-reject-requester" class="ml-2">Loading...</span>
                            </div>
                        </div>
                    </div>

                    <form id="pr-rejection-form-submit" class="space-y-6">
                        <div>
                            <label for="rejection-reason" class="block text-sm font-medium text-gray-700 mb-2">
                                Rejection Reason <span class="text-red-500">*</span>
                            </label>
                            <select id="rejection-reason" name="rejection_reason" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent">
                                <option value="">Select a reason</option>
                                <option value="Incomplete Information">Incomplete Information</option>
                                <option value="Budget Exceeded">Budget Exceeded</option>
                                <option value="Technical Specifications Unclear">Technical Specifications Unclear</option>
                                <option value="Vendor Selection Issues">Vendor Selection Issues</option>
                                <option value="Timeline Constraints">Timeline Constraints</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div>
                            <label for="rejection-details" class="block text-sm font-medium text-gray-700 mb-2">
                                Additional Details <span class="text-red-500">*</span>
                            </label>
                            <textarea id="rejection-details" name="rejection_details" rows="4" required 
                                placeholder="Please provide specific details about why this PR is being rejected and what needs to be addressed..."
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"></textarea>
                        </div>

                        <div>
                            <label for="suggested-actions" class="block text-sm font-medium text-gray-700 mb-2">
                                Suggested Actions
                            </label>
                            <textarea id="suggested-actions" name="suggested_actions" rows="3" 
                                placeholder="What actions should the requester take to address the issues?"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"></textarea>
                        </div>

                        <div class="flex space-x-4 pt-4">
                            <button type="submit" class="flex-1 bg-red-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                                <i class="fas fa-times mr-2"></i>Confirm Rejection
                            </button>
                            <button type="button" onclick="showPRApprovalForm()" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                                <i class="fas fa-arrow-left mr-2"></i>Back to Review
                            </button>
                        </div>
                    </form>
                </div>`;
            
            // Load PR details for rejection
            loadPRDetailsForRejection();
        }

        // Show PR approval form (go back from rejection)
        function showPRApprovalForm() {
            const container = document.getElementById('pr-approval-section');
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-lg p-8 card-shadow">
                  <h2 class="text-2xl font-bold mb-4">Review Purchase Requisition</h2>
                  <p class="text-gray-700 mb-6">Please review PR <strong>${id}</strong> and choose your action.</p>
                  
                  <div class="bg-gray-50 rounded-lg p-6 mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">PR Details</h3>
                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <span class="font-semibold text-gray-700">PR Number:</span>
                        <span class="ml-2">${id}</span>
                      </div>
                      <div>
                        <span class="font-semibold text-gray-700">Project:</span>
                        <span id="pr-project-display" class="ml-2">Loading...</span>
                      </div>
                      <div>
                        <span class="font-semibold text-gray-700">Department:</span>
                        <span id="pr-dept-display" class="ml-2">Loading...</span>
                      </div>
                      <div>
                        <span class="font-semibold text-gray-700">Requester:</span>
                        <span id="pr-requester-display" class="ml-2">Loading...</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="flex space-x-4">
                    <button onclick="submitPRApproval()" class="bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                      <i class="fas fa-check mr-2"></i>Approve PR
                    </button>
                    <button onclick="showPRRejectionForm()" class="bg-red-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                      <i class="fas fa-times mr-2"></i>Reject PR
                    </button>
                    <a href="/po_system" class="bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                      <i class="fas fa-arrow-left mr-2"></i>Cancel
                    </a>
                  </div>
                </div>`;
            
            // Load PR details
            loadPRDetails();
        }

        // Show PO rejection form
        function showPORejectionForm() {
            const container = document.getElementById('po-approval-section');
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-lg p-8 card-shadow">
                    <div class="text-center mb-8">
                        <div class="reject-bg text-white rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-times text-3xl"></i>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Reject Purchase Order</h2>
                        <p class="text-gray-600">Please provide feedback for the rejection. This will be sent to the requester.</p>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-6 mb-8">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">PO Details</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <span class="font-semibold text-gray-700">PO Number:</span>
                                <span class="ml-2">${id}</span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Project:</span>
                                <span id="po-reject-project" class="ml-2">Loading...</span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Vendor:</span>
                                <span id="po-reject-vendor" class="ml-2">Loading...</span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Total Amount:</span>
                                <span id="po-reject-amount" class="ml-2">Loading...</span>
                            </div>
                        </div>
                    </div>

                    <form id="po-rejection-form-submit" class="space-y-6">
                        <div>
                            <label for="po-rejection-reason" class="block text-sm font-medium text-gray-700 mb-2">
                                Rejection Reason <span class="text-red-500">*</span>
                            </label>
                            <select id="po-rejection-reason" name="rejection_reason" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent">
                                <option value="">Select a reason</option>
                                <option value="Pricing Issues">Pricing Issues</option>
                                <option value="Vendor Concerns">Vendor Concerns</option>
                                <option value="Contract Terms">Contract Terms</option>
                                <option value="Budget Constraints">Budget Constraints</option>
                                <option value="Technical Specifications">Technical Specifications</option>
                                <option value="Timeline Issues">Timeline Issues</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div>
                            <label for="po-rejection-details" class="block text-sm font-medium text-gray-700 mb-2">
                                Additional Details <span class="text-red-500">*</span>
                            </label>
                            <textarea id="po-rejection-details" name="rejection_details" rows="4" required 
                                placeholder="Please provide specific details about why this PO is being rejected and what needs to be addressed..."
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"></textarea>
                        </div>

                        <div>
                            <label for="po-suggested-actions" class="block text-sm font-medium text-gray-700 mb-2">
                                Suggested Actions
                            </label>
                            <textarea id="po-suggested-actions" name="suggested_actions" rows="3" 
                                placeholder="What actions should the requester take to address the issues?"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"></textarea>
                        </div>

                        <div class="flex space-x-4 pt-4">
                            <button type="submit" class="flex-1 bg-red-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                                <i class="fas fa-times mr-2"></i>Confirm Rejection
                            </button>
                            <button type="button" onclick="showPOApprovalForm()" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                                <i class="fas fa-arrow-left mr-2"></i>Back to Review
                            </button>
                        </div>
                    </form>
                </div>`;
            
            // Load PO details for rejection
            loadPODetailsForRejection();
        }

        // Show PO approval form (go back from rejection)
        function showPOApprovalForm() {
            const container = document.getElementById('po-approval-section');
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-lg p-8 card-shadow">
                  <h2 class="text-2xl font-bold mb-4">Review Purchase Order</h2>
                  <p class="text-gray-700 mb-6">Please review PO <strong>${id}</strong> as <strong>${role}</strong> and choose your action.</p>
                  
                  <div class="bg-gray-50 rounded-lg p-6 mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">PO Details</h3>
                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <span class="font-semibold text-gray-700">PO Number:</span>
                        <span class="ml-2">${id}</span>
                      </div>
                      <div>
                        <span class="font-semibold text-gray-700">Project:</span>
                        <span id="po-project-display" class="ml-2">Loading...</span>
                      </div>
                      <div>
                        <span class="font-semibold text-gray-700">Vendor:</span>
                        <span id="po-vendor-display" class="ml-2">Loading...</span>
                      </div>
                      <div>
                        <span class="font-semibold text-gray-700">Total Amount:</span>
                        <span id="po-amount-display" class="ml-2">Loading...</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="flex space-x-4">
                    <button onclick="submitPOApproval()" class="bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                      <i class="fas fa-check mr-2"></i>Approve PO
                    </button>
                    <button onclick="showPORejectionForm()" class="bg-red-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                      <i class="fas fa-times mr-2"></i>Reject PO
                    </button>
                    <a href="/po_system" class="bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                      <i class="fas fa-arrow-left mr-2"></i>Cancel
                    </a>
                  </div>
                </div>`;
            
            // Load PO details
            loadPODetails();
        }

        // Submit PO approval
        function submitPOApproval() {
            // Show loading state
            const container = document.getElementById('po-approval-section');
            container.innerHTML = `
                <div class="text-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                    <p class="text-gray-600">Processing approval...</p>
                </div>`;
            
            const formData = new FormData();
            formData.append('po_number', id);
            formData.append('action', 'approve');
            formData.append('role', role);

            fetch('/approve_po', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    document.getElementById('po-approval-section').innerHTML = `
                        <div class="success-bg text-white rounded-lg p-8 text-center card-shadow">
                            <div class="mb-6">
                                <i class="fas fa-check-circle text-6xl mb-4"></i>
                                <h2 class="text-3xl font-bold mb-2">Purchase Order Approved!</h2>
                                <p class="text-lg opacity-90" id="po-approval-message">
                                    The PO has been successfully approved and is now ready for processing.
                                </p>
                            </div>
                            
                            <div class="bg-white bg-opacity-20 rounded-lg p-6 mb-6">
                                <h3 class="text-xl font-semibold mb-4">PO Details</h3>
                                <div class="grid grid-cols-2 gap-4 text-left">
                                    <div>
                                        <span class="font-semibold">PO Number:</span>
                                        <span id="po-number-display" class="ml-2">${id}</span>
                                    </div>
                                    <div>
                                        <span class="font-semibold">Project:</span>
                                        <span id="po-project-display" class="ml-2">Loading...</span>
                                    </div>
                                    <div>
                                        <span class="font-semibold">Vendor:</span>
                                        <span id="po-vendor-display" class="ml-2">Loading...</span>
                                    </div>
                                    <div>
                                        <span class="font-semibold">Total Amount:</span>
                                        <span id="po-amount-display" class="ml-2">Loading...</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <a href="/po_system" class="inline-block bg-white text-green-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
                                    <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                                </a>
                                <p class="text-sm opacity-75">An email notification has been sent to the requester.</p>
                            </div>
                        </div>`;
                    
                    // Load PO details
                    loadPODetails();
                } else {
                    alert('Error approving PO: ' + (data.message || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error approving PO. Please try again.');
            });
        }

        // Handle PR rejection form submission
        document.addEventListener('submit', function(e) {
            console.log('Form submitted:', e.target.id);
            if (e.target.id === 'pr-rejection-form-submit') {
                console.log('Processing PR rejection...');
                e.preventDefault();
                
                const formData = new FormData(e.target);
                formData.append('pr_number', id);
                formData.append('action', 'reject');
                formData.append('role', role);

                console.log('Form data:', {
                    pr_number: id,
                    action: 'reject',
                    role: role,
                    rejection_reason: formData.get('rejection_reason'),
                    rejection_details: formData.get('rejection_details'),
                    suggested_actions: formData.get('suggested_actions')
                });

                // Submit rejection with feedback
                fetch('/approve_pr', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => {
                    console.log('Response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('Response data:', data);
                    if (data.success) {
                        alert('PR rejected successfully. Feedback has been sent to the requester.');
                        window.location.href = '/po_system';
                    } else {
                        alert('Error rejecting PR: ' + (data.message || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error rejecting PR. Please try again.');
                });
            }
        });

        // Handle PO rejection form submission
        document.addEventListener('submit', function(e) {
            console.log('Form submitted:', e.target.id);
            if (e.target.id === 'po-rejection-form-submit') {
                console.log('Processing PO rejection...');
                e.preventDefault();
                
                const formData = new FormData(e.target);
                formData.append('po_number', id);
                formData.append('action', 'reject');
                formData.append('role', role);

                console.log('Form data:', {
                    po_number: id,
                    action: 'reject',
                    role: role,
                    rejection_reason: formData.get('rejection_reason'),
                    rejection_details: formData.get('rejection_details'),
                    suggested_actions: formData.get('suggested_actions')
                });

                // Submit rejection with feedback
                fetch('/approve_po', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => {
                    console.log('Response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('Response data:', data);
                    if (data.success) {
                        alert('PO rejected successfully. Feedback has been sent to the requester.');
                        window.location.href = '/po_system';
                    } else {
                        alert('Error rejecting PO: ' + (data.message || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error rejecting PO. Please try again.');
                });
            }
        });



        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            showSection();
        });
    </script>
</body>
</html>
